# あおば給食管理システム 仕様書

## 📋 概要

あおば給食管理システムは、障害者福祉施設における給食注文・管理を効率化するWebアプリケーションです。利用者カテゴリ別の料金設定、給食注文、評価入力、管理機能を提供します。

### 🎯 対象施設
- A型利用者
- B型利用者
- 体験利用者
- 職員

---

## 🏗️ システム構成

### 技術スタック
- **フロントエンド**: React 19.1.0 + TypeScript
- **UIライブラリ**: Material-UI v7
- **状態管理**: React Context + useReducer
- **ビルドツール**: Create React App
- **デプロイ**: GitHub Pages
- **CI/CD**: GitHub Actions

### アクセス情報
- **本番URL**: https://mokemoke0821.github.io/aoba-meal-app
- **リポジトリ**: https://github.com/mokemoke0821/aoba-meal-app

---

## 🎨 ユーザーインターフェース設計

### カラーテーマ
```typescript
const theme = {
  primary: '#1976d2',      // ブルー
  secondary: '#dc004e',    // レッド
  A型: '#1976d2',         // ブルー
  B型: '#2e7d32',         // グリーン
  職員: '#f57c00',        // オレンジ
  体験者: '#9c27b0'       // パープル
}
```

### レスポンシブ対応
- **モバイル**: 320px〜768px
- **タブレット**: 768px〜1024px
- **デスクトップ**: 1024px以上

---

## 📱 機能仕様

## 1. 利用者向け機能

### 1.1 カテゴリ選択画面 ✅ **実装済み**

#### 概要
利用者が所属するカテゴリを選択する初期画面

#### 表示要素
- システムタイトル: "あおば給食管理システム"
- サブタイトル: "利用者カテゴリを選択してください"
- カテゴリカード（4種類）
- 管理者メニューボタン

#### カテゴリ設定
| カテゴリ | 表示名 | アイコン | 料金 | 説明 |
|---------|--------|---------|------|------|
| A型 | A型利用者 | 🏭 | 100円 | 雇用契約有り |
| B型 | B型利用者 | 🛠️ | 0円 | 雇用契約無し |
| 職員 | 職員 | 👥 | 400円 | 施設職員 |
| 体験者 | 体験利用者 | 🌱 | 400円 | 体験利用 |

#### 操作フロー
1. カテゴリカードをクリック
2. 選択したカテゴリを状態に保存
3. 利用者選択画面に遷移

### 1.2 利用者選択画面 ✅ **実装済み**

#### 概要
選択したカテゴリの利用者一覧から個人を選択

#### 表示要素
- 戻るボタン
- カテゴリ名とアイコン
- 利用者カード一覧
- 管理者メニューボタン

#### 利用者カード情報
- 表示番号 + 氏名
- 所属グループ
- 料金
- 体験利用フラグ（該当者のみ）

#### サンプルデータ
```typescript
users: [
  { name: '田中太郎', category: 'A型', price: 100 },
  { name: '佐藤花子', category: 'B型', price: 0 },
  { name: '山田次郎', category: '職員', price: 400 },
  { name: '鈴木美咲', category: '体験者', price: 400, trial: true }
]
```

### 1.3 給食注文画面 ✅ **実装済み**

#### 概要
選択した利用者の給食注文・キャンセル

#### 表示要素
- 戻るボタン
- ページタイトル: "🍱 給食注文"
- 今日の日付（和暦表示）
- 利用者情報カード
- 注文状況表示
- アクションボタン

#### 利用者情報カード
- アバター（グループカラー）
- 利用者名
- グループ表示名のチップ
- 給食料金

#### 注文ロジック
- **未注文時**: 注文ボタン表示
- **注文済み時**: キャンセルボタン + 評価入力ボタン表示
- 重複注文防止機能
- 注文確認ダイアログ

#### データ構造
```typescript
interface MealRecord {
  id: string;
  userId: string;
  userName: string;
  userGroup: string;
  userCategory: UserCategory;
  date: string; // 'yyyy-MM-dd'
  rating: number; // 0-10
  price: number;
  menuName: string;
  notes: string;
}
```

### 1.4 評価入力画面 ✅ **実装済み**

#### 概要
給食に対する10段階評価の入力

#### 表示要素
- 戻るボタン
- ページタイトル: "🍱 給食の評価"
- 利用者情報表示
- 評価選択グリッド（1-10点）
- 選択中評価表示
- 送信ボタン

#### 評価システム
- **評価範囲**: 1-10点
- **表示方式**: 絵文字 + 数値
- **グリッドレイアウト**: 
  - モバイル: 2列
  - タブレット: 5列
  - デスクトップ: 5列

#### 評価絵文字マッピング
```typescript
const RATING_EMOJIS = {
  1: '😢', 2: '😢',  // 1-2点: 美味しくない
  3: '😞', 4: '😞',  // 3-4点: あまり美味しくない
  5: '😐', 6: '😐',  // 5-6点: 普通
  7: '😊', 8: '😊',  // 7-8点: 美味しい
  9: '😍', 10: '😍'  // 9-10点: とても美味しい
}
```

#### 送信フロー
1. 評価選択
2. 送信ボタンクリック
3. データベース更新
4. ありがとうダイアログ表示（3秒）
5. 自動的に前画面に戻る

---

## 2. 管理者機能

### 2.1 管理者パネル ✅ **実装済み**

#### 概要
管理機能へのメインメニュー

#### 表示要素
- 戻るボタン
- ページタイトル: "管理者メニュー"
- 機能カード（4種類）

#### 管理機能メニュー
| 機能 | アイコン | 説明 | 実装状況 |
|------|---------|------|----------|
| ユーザー管理 | 👥 | 利用者の登録・編集・削除 | ✅ 実装済み |
| メニュー管理 | 🍽️ | 給食メニューの管理 | ✅ 実装済み |
| 統計・レポート | 📊 | 利用状況の確認 | ✅ 実装済み |
| 設定 | ⚙️ | システム設定 | ✅ 実装済み |

### 2.2 ユーザー管理 ✅ **実装済み**

#### 概要
利用者の登録・編集・削除・一覧表示

#### 主要機能
- **一覧表示**: DataGridによる表形式表示
- **検索・フィルター**: 名前検索、グループフィルター
- **CRUD操作**: 作成・読み取り・更新・削除
- **バルク操作**: 複数選択による一括操作
- **データ検証**: 入力値の妥当性チェック
- **インポート/エクスポート**: CSV形式

#### 表示項目
- ID、氏名、グループ、カテゴリ
- 表示番号、料金、作成日
- アクティブ状態、体験フラグ
- 操作ボタン（編集・削除・表示切替）

#### フォーム項目
```typescript
interface UserFormData {
  name: string;           // 利用者名（必須、50文字以内）
  group: Group;           // グループ（必須）
  category: UserCategory; // カテゴリ（自動設定）
  displayNumber: number;  // 表示番号（自動採番）
  trialUser: boolean;     // 体験利用フラグ
  price: number;          // 料金（カテゴリ別自動設定）
  notes?: string;         // 備考
}
```

#### 統計情報
- 総利用者数
- アクティブ利用者数
- 体験利用者数
- 有料利用者数
- グループ別利用者数

### 2.3 統計・レポート ✅ **実装済み**

#### 概要
給食利用状況の統計表示とレポート生成

#### 主要機能
- **期間指定**: 日別・週別・月別・カスタム期間
- **統計グラフ**: 
  - 日別注文数推移（折れ線グラフ）
  - グループ別利用状況（円グラフ）
  - 評価分布（棒グラフ）
- **集計データ**: 
  - 総注文数
  - 平均評価
  - 売上金額
  - 利用率

#### 表示項目
- 注文数統計
- 評価統計
- 収益統計
- 利用者別統計
- グループ別統計

#### エクスポート機能
- PDF レポート出力
- CSV データ出力
- 印刷機能

### 2.4 メニュー管理 ✅ **実装済み**

#### 概要
給食メニューの管理と分析

#### 主要機能
- **日別メニュー設定**: カレンダー形式でメニュー設定
- **メニュー人気度分析**: 注文頻度と評価の分析
- **メニュー提案**: AIによる最適メニュー提案
- **テンプレート管理**: 週間・月間メニューテンプレート

#### メニュー項目
```typescript
interface MenuItem {
  id: string;
  name: string;          // メニュー名
  description?: string;  // 説明
  price: number;         // 価格
  category: 'main' | 'side' | 'soup' | 'dessert';
  allergens?: string[];  // アレルゲン情報
  nutritionInfo?: {      // 栄養情報
    calories: number;
    protein: number;
    carbs: number;
    fat: number;
  };
}
```

#### 分析機能
- メニュー別注文頻度
- 平均評価
- 売上分析
- 人気度ランキング

### 2.5 設定 ✅ **実装済み**

#### 概要
システム全体の設定管理

#### 設定カテゴリ

##### 通知設定
- 給食注文の通知
- 評価入力の通知

##### セキュリティ設定
- 自動ログアウト
- データ暗号化

##### データ管理
- データのバックアップ
- 古いデータの自動削除

##### 表示設定
- ダークモード
- 大きな文字表示

##### システム情報
- アプリバージョン: 1.0.0
- 最終更新: 2024年1月
- 開発者情報

---

## 📊 データ構造

### 状態管理
```typescript
interface AppState {
  currentView: ViewType;
  users: User[];
  mealRecords: MealRecord[];
  groups: Group[];
  selectedDate: Date;
  selectedUser: User | null;
  selectedGroup: Group | null;
  selectedCategory: UserCategory | null;
  currentMenu: MenuItem | null;
  dailyMenus: DailyMenu[];
  requireAdminAuth: boolean;
}
```

### 主要型定義
```typescript
// 利用者情報
interface User {
  id: string;
  name: string;
  group: Group;
  category: UserCategory;
  displayNumber: number;
  price: number;
  createdAt: string;
  isActive?: boolean;
  trialUser: boolean;
  notes?: string;
}

// 給食記録
interface MealRecord {
  id: string;
  userId: string;
  userName: string;
  userGroup: string;
  userCategory: UserCategory;
  date: string;
  rating: number;
  price: number;
  menuName?: string;
  notes?: string;
}

// 画面遷移
type ViewType = 
  | 'categorySelect'
  | 'userSelect'
  | 'mealOrder'
  | 'rating'
  | 'admin'
  | 'adminPanel'
  | 'adminAuth'
  | 'statistics'
  | 'userManagement'
  | 'menuManagement'
  | 'settings';
```

---

## 🚀 デプロイメント

### GitHub Pages設定
- **ブランチ**: gh-pages
- **ビルドアクション**: GitHub Actions
- **カスタムドメイン**: 未設定
- **HTTPS**: 有効

### ビルド設定
```json
{
  "homepage": "https://mokemoke0821.github.io/aoba-meal-app",
  "scripts": {
    "build": "cross-env DISABLE_ESLINT_PLUGIN=true react-scripts build",
    "deploy": "gh-pages -d build"
  }
}
```

### CI/CDパイプライン
1. **トリガー**: mainブランチへのpush
2. **ビルド**: npm run build
3. **テスト**: 構文チェック
4. **デプロイ**: gh-pagesブランチに自動デプロイ

---

## 🔧 未実装機能

### 1. 認証・認可システム
- **管理者ログイン**: パスワード認証
- **利用者認証**: PIN認証
- **権限管理**: ロールベースアクセス制御
- **セッション管理**: 自動ログアウト

### 2. データ永続化
- **ローカルストレージ**: ブラウザ内データ保存
- **バックエンドAPI**: データベース連携
- **データ同期**: 複数端末間同期
- **バックアップ**: 定期自動バックアップ

### 3. 高度な統計機能
- **予測分析**: 需要予測
- **コスト分析**: 原価計算
- **栄養分析**: 栄養バランス評価
- **カスタムレポート**: 自由形式レポート

### 4. 通知システム
- **リアルタイム通知**: WebSocket通信
- **メール通知**: 管理者向けメール
- **プッシュ通知**: PWA対応
- **アラート機能**: 異常値検知

### 5. モバイル最適化
- **PWA対応**: オフライン機能
- **タッチ操作**: ジェスチャー対応
- **音声入力**: 評価入力の音声化
- **バーコード**: 利用者識別

### 6. 外部連携
- **決済システム**: キャッシュレス決済
- **在庫管理**: 食材管理システム
- **栄養管理**: 栄養計算システム
- **会計システム**: 売上データ連携

---

## 🐛 既知の問題・制限事項

### 1. データ永続化
- **現状**: ブラウザリロードでデータ消失
- **対策**: ローカルストレージ実装予定

### 2. 認証機能
- **現状**: 認証なしで管理機能アクセス可能
- **対策**: 管理者認証機能実装予定

### 3. レスポンシブ対応
- **現状**: 基本的な対応のみ
- **対策**: より詳細なブレークポイント調整

### 4. エラーハンドリング
- **現状**: 基本的なエラー表示のみ
- **対策**: 包括的なエラー処理実装

---

## 📈 今後の開発計画

### Phase 1: 基盤強化（1-2ヶ月）
- [ ] データ永続化（LocalStorage）
- [ ] 基本認証システム
- [ ] エラーハンドリング強化
- [ ] テストコード追加

### Phase 2: 機能拡張（2-3ヶ月）
- [ ] 高度な統計機能
- [ ] 通知システム
- [ ] PWA対応
- [ ] バックエンドAPI設計

### Phase 3: 運用改善（3-4ヶ月）
- [ ] パフォーマンス最適化
- [ ] セキュリティ強化
- [ ] 外部システム連携
- [ ] 運用監視機能

---

## 📞 サポート・メンテナンス

### 開発チーム
- **プロジェクトリーダー**: あおば給食管理システム開発チーム
- **技術スタック**: React + TypeScript + Material-UI
- **開発期間**: 2024年1月〜

### 問い合わせ
- **GitHub Issues**: https://github.com/mokemoke0821/aoba-meal-app/issues
- **技術的質問**: GitHubのDiscussions機能を利用

### ライセンス
- **ライセンス**: MIT License
- **オープンソース**: GitHub公開

---

**最終更新**: 2024年1月  
**バージョン**: 1.0.0  
**ドキュメント作成者**: Claude AI Assistant 